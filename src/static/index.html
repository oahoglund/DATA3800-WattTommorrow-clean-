<!DOCTYPE html>
<html>
<head>
    <title>⚡ Watt Tomorrow – Prediction Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f6f7fb;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 900px;
            margin: auto;
            padding: 30px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
            box-shadow: 0 2px 10px #ddd;
        }

        button, select, textarea, input {
            width: 100%;
            padding: 12px;
            margin-top: 12px;
            border-radius: 8px;
            border: 1px solid #bbb;
            font-size: 15px;
        }

        button {
            background: #0078ff;
            color: white;
            cursor: pointer;
            font-weight: bold;
            border: none;
        }

        button:hover {
            background: #005fcc;
        }

        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            white-space: pre-wrap;
            max-height: 350px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 10px;
            border-left: 5px solid #0078ff;
            padding-left: 10px;
        }
    </style>
</head>
<body>
<div class="container">

<h1>⚡ Watt Tomorrow – Prediction Dashboard</h1>

<!-- =============================================================== -->
<!-- STEP 1: LOAD AVAILABLE IDs -->
<!-- =============================================================== -->
<div class="card">
    <div class="section-title">1. Load Available Prediction IDs</div>

    <button onclick="loadIDs()">Load Prediction IDs</button>

    <select id="idSelector">
        <option value="">-- Choose ID --</option>
    </select>

    <button onclick="loadRow()">Load Selected Row</button>

    <h3>CSV Row Data</h3>
    <pre id="rowOutput">No row selected yet.</pre>
</div>


<!-- =============================================================== -->
<!-- STEP 2: GENERATE ML PREDICTION -->
<!-- =============================================================== -->
<div class="card">
    <div class="section-title">2. Generate ML Prediction From Row</div>

    <button onclick="generatePrediction()">Generate Prediction</button>

    <h3>Predicted Price</h3>
    <input id="predictionValue" readonly placeholder="Prediction will appear here..." />
</div>


<!-- =============================================================== -->
<!-- STEP 3: SUMMARIZE MANUALLY -->
<!-- =============================================================== -->
<div class="card">
    <div class="section-title">3. Summarize Prediction</div>

    <label>Predicted Price (manual input):</label>
    <input id="summPrice" placeholder="Enter predicted price..." />

    <label>Your Question:</label>
    <input id="summQuestion" placeholder="Ask something about the prediction..." />

    <button onclick="summarize()">Summarize</button>

    <h3>AI Summary</h3>
    <pre id="summaryOutput">No summary yet.</pre>
</div>

</div> <!-- container -->


<script>
let loadedRow = null;

// ----------------------------------------------------------
// STEP 1A → Load available IDs
// ----------------------------------------------------------
async function loadIDs() {
    const response = await fetch("/predict?page=1&page_size=500");
    const data = await response.json();

    const sel = document.getElementById("idSelector");
    sel.innerHTML = '<option value="">-- Choose ID --</option>';

    data.predictions.forEach(row => {
        sel.innerHTML += `<option value="${row.id}">ID ${row.id}</option>`;
    });
}

// ----------------------------------------------------------
// STEP 1B → Load CSV row by ID
// ----------------------------------------------------------
async function loadRow() {
    const id = document.getElementById("idSelector").value;
    if (!id) return alert("Select an ID first.");

    const response = await fetch(`/predict/${id}`);
    loadedRow = await response.json();

    document.getElementById("rowOutput").textContent =
        JSON.stringify(loadedRow, null, 2);
}

// ----------------------------------------------------------
// STEP 2 → Predict using loaded row
// ----------------------------------------------------------
async function generatePrediction() {
    if (!loadedRow) {
        alert("Load a CSV row first.");
        return;
    }

    const response = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(loadedRow)
    });

    const data = await response.json();

    document.getElementById("predictionValue").value = data.predicted_price ?? "Error";
    alert("Prediction generated!");
}

// ----------------------------------------------------------
// STEP 3 → Summarize manually
// ----------------------------------------------------------
async function summarize() {
    const price = document.getElementById("summPrice").value;
    const question = document.getElementById("summQuestion").value;

    if (!price) return alert("Enter predicted price first.");

    const payload = {
        predicted_price: parseFloat(price),
        user_query: question || "Explain this prediction."
    };

    const response = await fetch("/summarize", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const data = await response.json();

    document.getElementById("summaryOutput").textContent = data;
}
</script>

</body>
</html>
